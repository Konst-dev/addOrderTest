1.
1.1 Файл test.php содержит функцию addOrder, принимающую на входе event_id, event_date, ticket_adult_price, ticket_adult_quantity, ticket_kid_price, ticket_kid_quantity и user_id. Функция генерирует новый баркод, затем проверяет, нет ли такого же баркода в базе данных, если нет, то обращается к API (для эмуляции API используется скрипт book.php, который рандомно выдает сообщение об успехе или ошибке). Если баркод существует в БД или пришел ответ от API {error: 'barcode already exists'}, генерируется новый баркод, и т.д. до тех пор,пока баркод не будет удовлетворять всем требованиям. Далее функция обращается к API (для эмуляции используется скрипт aprove.php, который всегда выдает {message: 'order successfully aproved'}). В случае ответа с сообщением об успехе. Функция сохраняет данные в БД в таблицу orders.

1.2. Функция getNewBarcode генерирует новый баркод перемешиванием строки, содержащей цифры.

1.3. Функция fetchPost отправляет запрос на API методом POST.

1.4. Для работы с БД используется отдельных класс Db.php, содержащий следующие свойства и методы:

- свойство config - массив, содержащий настройки подключения к БД.
- метод getConnection устанавливает соединение с БД с помощью PDO.
- метод prepareDsnString возвращает форматированную строку, необходимую для подключения к БД через PDO
- метод query отправляет запрос к БД, используя строку с SQL-запросом и параметрами.
- метод queryWhereAssoc обращается к БД  и возвращает ассоциативный массив с данными из БД.
- метод barcodeExistsInDb проверяет, если ли такой баркод в БД.
- метод insertOrder вставляет данные в таблицу.

1.5 дамп базы данных содержится в файле nevatrip.sql

2.
2.1 структура таблицы приведена в файле DB2.1.png
БД составлена с учетом 3-й нормальной формы, требующей, чтобы все неключевые поля, содержимое которых может относиться к нескольким записям таблицы выносились в отдельные таблицы. Очевидно, что событие, юзер, тип билета и их количество могут относиться к нескольким записям таблицы, поэтому их нужно вынести в отдельные таблицы. 
В результате БД состоит из таблиц для следующих сущностей: заказ, событие, юзер, билет, тип билета.
В результате типы билетов могут добавляться без изменения всех остальных таблиц (в исходной же БД при добавлении новых типов билетов пришлось бы добавлять новые поля, что повлияло бы на логику кода, работающего с БД).
Принадлежнось билета заказу и типу билета в таблице tikets однозначно определяется id заказа и id типа билета, также содержит количество купленных билетов данного типа.

2.2 Поскольку теперь баркод является свойством отдельного билета, а не заказа, поле barcode переностится в таблицу tikets. Теперь каждый билет имеет уникальный баркод, а принадлежность билета заказу и типу билета также определяется по их id.


